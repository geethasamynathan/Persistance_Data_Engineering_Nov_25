
# Databricks ACL Example – Create Users, Groups, and Permissions

## 1. Objective

Small, trainer-friendly example of **Access Control Lists (ACLs)** in Databricks:

- Create a **user**
- Create a **group**
- Grant the group access to:
  - A **SQL warehouse** (compute ACL)
  - A **table** (data ACL using SQL `GRANT`)

This can be used as a quick demo of security & permissions in Databricks.

---

## 2. What is ACL in Databricks?

**ACL (Access Control List)** = rules that define **who can do what** on which object.

In Databricks, ACLs apply to:

- Workspace objects – notebooks, folders, clusters, jobs, SQL warehouses
- Data objects – catalogs, schemas, tables, views (via Unity Catalog)

Examples:

- “Group `sql_readonly` can **use** the SQL warehouse but **cannot manage** it.”
- “Only `data_engineers` can `INSERT` into a table; analysts can only `SELECT`.”

---

## 3. Step 1 – Create a User (Admin Only)

> You must be an **Account admin / Workspace admin**.

1. In Databricks, click your **workspace name / avatar** (top-right).
2. Choose **Admin settings** / **Admin console**.
3. Go to **User management → Users**.
4. Click **Add user** / **Invite user**.
5. Enter the email, e.g. `student1@example.com`.
6. Click **Add / Invite**.

The user receives an invitation email to join the workspace.

> In a training setup, you might create multiple users like `analyst1@…`, `analyst2@…`, etc.

---

## 4. Step 2 – Create a Group


Groups make ACL management much easier.

1. In **Admin settings**, open **Groups**.
2. Click **Create group**.
3. Name it, for example: **`sql_readonly`**.
4. Open the group and click **Add members**.
5. Add the new user (`student1@example.com`) to this group.

Now you’ll grant permissions to the **group** instead of each user one by one.

---

## 5. Step 3 – Grant ACL on a SQL Warehouse
## A. Create a workspace group

1. **Open Admin Settings**
   - Click your user icon (top-right).
   - Click **Admin settings**.

2. **Go to Identity and access**
   - On the left (like in your screenshot), click **Identity and access** (just above **Security**).

3. **Open the Groups tab**
   - At the top of the page you’ll see something like:
     - `Users | Groups | Service principals`
   - Click **Groups**.

4. **Create the group**
   - Click **Add group** / **Create group** (button on the right).
   - Enter a **Group name** (e.g., `de_team`, `analyst_group`).
   - Optionally, add **members**:
     - Search for users or service principals and add them to the group.
   - Click **Create** / **Save**.

Now the group exists in the workspace.

---

## B. Use the group in permissions (example)

After the group is created you can:

1. Right-click a **folder / notebook / job / cluster** → **Permissions / Share**.
2. Search for your group name (e.g., `analyst_group`).
3. Assign a role:
   - `Can View`
   - `Can Run`
   - `Can Edit`
   - `Can Manage`

This is where the group becomes useful for ACLs and role-based access.

You already have a **Serverless Starter Warehouse** visible on the *SQL Warehouses* page.

### 5.1 Open the Permissions Dialog

1. In the left sidebar, click **SQL Warehouses**.
2. In the list, find your warehouse, e.g. **Serverless Starter Warehouse**.
3. On that row, click the **… (three dots)** menu on the right.
4. Click **Permissions**.

You should see options like:

- Can Manage
- Can Use
- Can Restart
- Can View

### 5.2 Grant “Can Use” to the Group

1. In the permissions popup, click **Grant / Add**.
2. In the search field, type the group name: `sql_readonly`.
3. Select the group.
4. Choose **Can Use**.
5. Save.

Now:

- Members of `sql_readonly` can attach to this SQL warehouse and run queries.
- They **cannot manage** or delete the warehouse unless you give higher rights.

> Demo idea: log in as your student user and show that they can run queries using this warehouse, but cannot change settings.

---

## 6. Step 4 – ACL on a Table (Unity Catalog Example)

Let’s say you create a small demo table:

```sql
CREATE CATALOG demo_cat;
CREATE SCHEMA demo_cat.secure_schema;

CREATE OR REPLACE TABLE demo_cat.secure_schema.customers (
    customer_id INT,
    full_name   STRING,
    email       STRING,
    city        STRING
);
```

### 6.1 (Optional) Revoke Wide Access

To remove default public access:

```sql
REVOKE ALL PRIVILEGES
ON TABLE demo_cat.secure_schema.customers
FROM PUBLIC;
```

### 6.2 Grant Read-Only Access to the Group

```sql
GRANT SELECT
ON TABLE demo_cat.secure_schema.customers
TO `sql_readonly`;
```

Now:

- Any user in `sql_readonly` can run:

  ```sql
  SELECT * FROM demo_cat.secure_schema.customers;
  ```

- Users **not** in that group get a permission error.

This is a clear **data ACL** example.

---

## 7. Summary – Story for Students

1. **Create Users** – invite people into the Databricks workspace.
2. **Create Groups** – e.g., `sql_readonly`, `data_engineers`.
3. **ACL on Compute** – grant groups `Can Use` on SQL warehouses or clusters.
4. **ACL on Data** – use SQL `GRANT / REVOKE` to control who can `SELECT`, `INSERT`, `UPDATE`, etc.
5. Show different behavior by logging in as:
   - Admin (full access)
   - `sql_readonly` user (limited, read-only access)

**One-line explanation:**

> In Databricks, ACLs let us control which users and groups can use which compute resources and see which tables. By combining groups, SQL warehouses, and SQL `GRANT` statements, we can implement least-privilege access for analysts and engineers.
